{% extends 'miepi/base.html' %}

{% block title %}Inscritos{% endblock %}
{% block header_title %}Lista de Inscritos{% endblock %}

{% block content %}
<div class="container">

  <section class="form-card">

    <div class="table-responsive">
      <table>
        <thead>
          <tr>
            <th>Nombre</th>
            <th>Sub Zona</th>
            <th>Tel√©fono</th>
            <th>Grado</th>
            <th>Periodo</th>
            <th>QR</th>
            <th>Acciones</th>
          </tr>
        </thead>
        <tbody>
          {% for i in inscritos %}
          <tr>
            <td>{{ i.nombre }}</td>
            <td>{{ i.subzona }}</td>
            <td>{{ i.telefono }}</td>
            <td>{{ i.grado }}</td>
            <td>{{ i.periodo }}</td>
            <td>
              {% if i.qr_image %}
                <div class="qr-container">
                  <img src="{{ i.qr_image.url }}" width="80">
                  <br>
                  <a href="{{ i.qr_image.url }}" download>
                    <button class="qr-button">Descargar</button>
                  </a>
                </div>
              {% else %}
                <span>‚Äî</span>
              {% endif %}
            </td>
            <td style="padding:8px; text-align:center;">
                
                <!-- BOT√ìN ELIMINAR y aqui meteremos el de editar el registro -->
                <form method="post"
                      action="{% url 'miepi:eliminar_registros' i.id %}"
                      class="swal-delete"
                      data-nombre="{{ i.nombre }}"
                      style="display:inline;">
                    {% csrf_token %}
                    <button type="submit"
                            style="background:#e74c3c; color:#fff; border:none; padding:6px 10px; border-radius:6px; cursor:pointer;">
                        üóëÔ∏è
                    </button>
                </form>

            </td>
          </tr>
          {% empty %}
          <tr>
            <td colspan="6">No hay registros</td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>

  </section>

</div>

<style>
/* reutilizando tu dise√±o */
.form-card {
    background: #ffffff6f;
    padding: 24px;
    border-radius: 12px;
    box-shadow: 0 6px 18px rgba(0,0,0,0.1);
}

.table-responsive { overflow-x: auto; }

table {
    width: 100%;
    border-collapse: collapse;
    min-width: 700px;
}

th, td {
    padding: 10px;
    border-bottom: 1px solid #ddd;
    text-align: center;
}

th {
    background: #eaeaeab9;
}

.qr-container img {
    border-radius: 6px;
    margin-bottom: 5px;
}

.qr-button {
    background: #4aa3f0;
    font-size: 12px;
    padding: 6px 10px;
    border-radius: 6px;
    border: none;
    color: #fff;
    cursor: pointer;
}

.qr-button:hover {
    background: #3780c0;
}
</style>
{% endblock %}
{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function () {

    /* === CONFIRMAR ELIMINACI√ìN === */
    document.querySelectorAll('.swal-delete').forEach(form => {
        form.addEventListener('submit', function (e) {
            e.preventDefault();

            const nombre = form.dataset.nombre;

            Swal.fire({
                title: '¬øEliminar registro?',
                text: `Registro de ${nombre}`,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'S√≠, eliminar',
                cancelButtonText: 'Cancelar',
                confirmButtonColor: '#d33'
            }).then(result => {
                if (result.isConfirmed) {
                    form.submit();
                }
            });
        });
    });

});
</script>

{% if messages %}
<script>
document.addEventListener('DOMContentLoaded', function () {

    /* === MENSAJES DJANGO === */
    {% for message in messages %}
    Swal.fire({
        icon: "{% if 'success' in message.tags %}success{% elif 'warning' in message.tags %}warning{% else %}error{% endif %}",
        title: "{{ message|escapejs }}",
        timer: 1800,
        showConfirmButton: false
    });
    {% endfor %}

});
</script>
{% endif %}
{% endblock %}
