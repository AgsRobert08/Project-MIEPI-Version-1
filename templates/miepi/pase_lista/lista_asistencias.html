{% extends "miepi/base.html" %}

{% block title %}Asistencias{% endblock %}

{% block content %}
<h2 style="margin-bottom:15px;">üìã Lista de Asistencias</h2>

<table style="width:100%; border-collapse: collapse;">
    <thead>
        <tr style="background:#52658c; color:#fff;">
            <th style="padding:8px;">Nombre</th>
            <th style="padding:8px;">Fecha</th>
            <th style="padding:8px;">Hora</th>
            <th style="padding:8px;">Acciones</th>
        </tr>
    </thead>
    <tbody>
        {% for a in asistencias %}
        <tr style="border-bottom:1px solid #ddd;">
            <td style="padding:8px;">{{ a.inscrito.nombre }}</td>
            <td style="padding:8px;">{{ a.fecha }}</td>
            <td style="padding:8px;">{{ a.hora }}</td>
            <td style="padding:8px; text-align:center;">

                <!-- BOT√ìN ELIMINAR -->
                <form method="post"
                      action="{% url 'miepi:eliminar_asistencia' a.id %}"
                      class="swal-delete"
                      data-nombre="{{ a.inscrito.nombre }}"
                      style="display:inline;">
                    {% csrf_token %}
                    <button type="submit"
                            style="background:#e74c3c; color:#fff; border:none; padding:6px 10px; border-radius:6px; cursor:pointer;">
                        üóëÔ∏è
                    </button>
                </form>

            </td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="4" style="text-align:center; padding:15px;">
                No hay asistencias registradas
            </td>
        </tr>
        {% endfor %}
    </tbody>
</table>
{% endblock %}
{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function () {

    /* === CONFIRMAR ELIMINACI√ìN === */
    document.querySelectorAll('.swal-delete').forEach(form => {
        form.addEventListener('submit', function (e) {
            e.preventDefault();

            const nombre = form.dataset.nombre;

            Swal.fire({
                title: '¬øEliminar asistencia?',
                text: `Asistencia de ${nombre}`,
                icon: 'warning',
                showCancelButton: true,
                confirmButtonText: 'S√≠, eliminar',
                cancelButtonText: 'Cancelar',
                confirmButtonColor: '#d33'
            }).then(result => {
                if (result.isConfirmed) {
                    form.submit();
                }
            });
        });
    });

});
</script>

{% if messages %}
<script>
document.addEventListener('DOMContentLoaded', function () {

    /* === MENSAJES DJANGO === */
    {% for message in messages %}
    Swal.fire({
        icon: "{% if 'success' in message.tags %}success{% elif 'warning' in message.tags %}warning{% else %}error{% endif %}",
        title: "{{ message|escapejs }}",
        timer: 1800,
        showConfirmButton: false
    });
    {% endfor %}

});
</script>
{% endif %}
{% endblock %}
