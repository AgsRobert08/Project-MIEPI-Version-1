{% extends 'miepi/base.html' %}

{% block title %}Lista de Eventos{% endblock %}

{% block header_title %}Gestión de Eventos{% endblock %}

{% block content %}
<!-- Aquí va SOLO el contenido específico de eventos -->
<div class="bg-white p-6 rounded shadow">
  <style>
* { box-sizing: border-box; font-family: Arial, Helvetica, sans-serif; }
form { display: grid; grid-template-columns: repeat(2, 1fr); gap: 16px; }
label { font-size: 14px; color: #444; }
input, select { width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ccc; margin-top: 4px; }
button { padding: 10px; border: none; border-radius: 10px; background: #52658c; color: #fff; font-size: 16px; cursor: pointer; }
button:hover { background: #5b83a5; }
button:focus { outline: none; }

/* Botón centrado */
.submit-container { grid-column: 1 / -1; text-align: center; margin-top: 10px; }

/* Tabla */
table { width: 100%; border-collapse: collapse; background: #fff; border-radius: 10px; overflow: hidden; }
th, td { padding: 10px; border-bottom: 1px solid #ddd; text-align: center; font-size: 14px; }
th { background: #eaeaea; }

/* QR */
.qr-container { margin-top: 10px; text-align: center; }
.qr-button { background: #4aa3f0; font-size: 13px; padding: 6px 10px; margin-top: 4px; border-radius: 5px; cursor:pointer; color:#fff; border:none; }
.qr-button:hover { background: #3780c0; }

/* Popups centrados */
.popup {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%) scale(0.8);
    background: #ff6b6b;
    color: #fff;
    padding: 16px 24px;
    border-radius: 12px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.3);
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease, transform 0.3s ease;
    z-index: 9999;
    font-size: 16px;
    text-align: center;
    max-width: 300px;
}
.popup.show {
    opacity: 1;
    pointer-events: auto;
    transform: translate(-50%, -50%) scale(1);
}
</style>

    <!-- 
      ========================================
      ESTRUCTURA HTML (Para tu archivo index.html)
      ========================================
    -->

    <!-- DIV CON CLASE CARD -->

        <!-- Encabezado y Controles Unificados -->
        <div class="container">

    <section id="registro">
        <h1>Registro de Inscritos</h1>
        <form id="form">
            <div>
                <label>Nombre completo</label>
                <input type="text" id="nombre" required>
            </div>
            <div>
                <label>Sub zona</label>
                <input type="text" id="subzona" required>
            </div>
            <div>
                <label>Teléfono</label>
                <input type="tel" id="telefono" required>
            </div>
            <div>
                <label>Grado eclesiástico</label>
                <input type="text" id="grado" required>
            </div>
            <div>
                <label>Curso</label>
                <input type="text" id="curso" required>
            </div>
            <div>
                <label>¿Pago?</label>
                <select id="pago" required>
                    <option value="">Seleccione</option>
                    <option value="Sí">Sí</option>
                    <option value="No">No</option>
                </select>
            </div>
            <div>
                <label>Periodo de pago</label>
                <select id="periodo" disabled>
                    <option value="">Seleccione</option>
                    <option value="Primer periodo|1500">07 Ene - 21 Feb | $1,500</option>
                    <option value="Segundo periodo|1700">22 Feb - 31 Mar | $1,700</option>
                    <option value="Tercer periodo|1900">31 Mar - 26 Abr | $1,900</option>
                </select>
            </div>

            <div class="submit-container">
                <button type="submit">Registrar</button>
            </div>
        </form>
    </section>

    <section id="inscritos">
        <h1>Lista de Inscritos</h1>
        <table>
            <thead>
                <tr>
                    <th>Nombre</th>
                    <th>Sub zona</th>
                    <th>Teléfono</th>
                    <th>Grado</th>
                    <th>Curso</th>
                    <th>Pago</th>
                    <th>Periodo</th>
                    <th>Monto</th>
                    <th>QR</th>
                </tr>
            </thead>
            <tbody id="tabla"></tbody>
        </table>
    </section>
</div>

<div id="popup" class="popup"></div>

    <!-- 
      ========================================
      LÓGICA JAVASCRIPT (Para tu archivo app.js)
      ========================================
    -->
   <script src="https://cdn.jsdelivr.net/npm/qrcodejs/qrcode.min.js"></script>
<script>
const form = document.getElementById('form');
const tabla = document.getElementById('tabla');
const popup = document.getElementById('popup');
const inscritos = [];

const pagoSelect = document.getElementById('pago');
const periodoSelect = document.getElementById('periodo');

// Habilitar/deshabilitar periodo según pago
pagoSelect.addEventListener('change', () => {
    if(pagoSelect.value === 'Sí'){
        periodoSelect.disabled = false;
    } else {
        periodoSelect.value = '';
        periodoSelect.disabled = true;
    }
});

function showPopup(msg, color="#ff6b6b"){
    popup.textContent = msg;
    popup.style.background = color;
    popup.classList.add('show');
    setTimeout(() => popup.classList.remove('show'), 1000);
}

form.addEventListener('submit', function(e) {
    e.preventDefault();

    const nombre = document.getElementById('nombre').value.trim();
    const subzona = document.getElementById('subzona').value.trim();
    const telefono = document.getElementById('telefono').value.trim();
    const grado = document.getElementById('grado').value.trim();
    const curso = document.getElementById('curso').value.trim();
    const pago = pagoSelect.value;
    const periodoMonto = periodoSelect.value;

    // Validación campos
    if(!nombre || !subzona || !telefono || !grado || !curso || !pago || (pago==='Sí' && !periodoMonto)){
        showPopup("Todos los campos obligatorios deben llenarse");
        return;
    }

   // Validación duplicado
if(inscritos.some(p=>p.nombre.toLowerCase()===nombre.toLowerCase() && p.telefono===telefono)){
    showPopup("Esta persona ya está registrada");
    form.reset();       // <-- Limpia todos los campos
    periodoSelect.disabled = true; // <-- Desactiva periodo
    return;
}


    inscritos.push({nombre, telefono});

    let periodo = '';
    let monto = '';
    if(pago === 'Sí'){
        [periodo, monto] = periodoMonto.split('|');
    } else {
        periodo = 'No pagó';
        monto = '-';
    }

    // Insertar fila
    const fila = document.createElement('tr');
    const qrCell = document.createElement('td');
    const qrDiv = document.createElement('div');
    qrDiv.classList.add('qr-container');

    const qrButton = document.createElement('button');
    qrButton.classList.add('qr-button');
    qrButton.textContent = 'Ver QR';
    qrButton.onclick = () => {
        qrDiv.innerHTML = '';
        const qr = new QRCode(qrDiv, {
            text: `Nombre: ${nombre}\nSub zona: ${subzona}\nTel: ${telefono}\nGrado: ${grado}\nCurso: ${curso}\nPago: ${pago}\nPeriodo: ${periodo}\nMonto: ${monto}`,
            width: 100,
            height: 100
        });
        setTimeout(() => {
            const qrImg = qrDiv.querySelector('img');
            if(qrImg){
                const link = document.createElement('a');
                link.href = qrImg.src;
                link.download = `${nombre}.png`;
                link.textContent = 'Descargar QR';
                qrDiv.appendChild(document.createElement('br'));
                qrDiv.appendChild(link);
            }
        }, 100);
    };

    qrDiv.appendChild(qrButton);
    qrCell.appendChild(qrDiv);

    fila.innerHTML = `<td>${nombre}</td><td>${subzona}</td><td>${telefono}</td><td>${grado}</td><td>${curso}</td><td>${pago}</td><td>${periodo}</td><td>${monto}</td>`;
    fila.appendChild(qrCell);
    tabla.appendChild(fila);

    form.reset();
    periodoSelect.disabled = true; // reset
    showPopup("Inscripción realizada con éxito!", "#4aa3f0");
});
</script>

{% endblock %}

Al hacer esto, la página de eventos heredará automáticamente el Sidebar, el Navbar y el Footer que acabo de crear.